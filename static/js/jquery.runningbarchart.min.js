/**
 * runningBarChar -  A usefull and funny running chart jQuery plug-in
 * @copyright 2012, Rottensteiner Stefan - rottensteiner.stefan@gmx.at
 * @version 0.1.4
 * @license http://www.opensource.org/licenses/mit-license.php  - MIT
 * @license http://www.opensource.org/licenses/gpl-license.php  - GPL
 * Online compressed with http://jscompress.com/
 */
(function(a){var b="0.1.4";var c={direction:"rtl",rows:{maxValue:100,stepWidth:20},columns:{number:10}};var d=function(b,c){var d=a(this).data("runningBarChart"),e=d.ra,c=b+"",f=e.find("div.row").length,g=f?Math.floor(1/(1+f)*100):100;e.prepend('<div class="row" data-value="'+b+'"><div class="label">'+c+"</div></div>");e.find("div.row").css("height",g+"%")};var e={shiftColumns:function(a,b,c){b.animate({marginLeft:-1*c+"px"},"fast",function(){a.find(".column:first-child").remove();b.css("marginLeft","auto")})},insertColumn:function(a,b){return a.append(b)},getWorkingColumnContent:function(a){return a.find(".column:last-child .content")},getWorkingColumn:function(a){return a.find(".column:last-child")}};var f={shiftColumns:function(a,b,c){b.css({marginLeft:-1*c+"px"});b.animate({marginLeft:"0px"},"fast",function(){a.find(".column:last-child").remove()})},insertColumn:function(a,b){return a.prepend(b)},getWorkingColumnContent:function(a){return a.find(".column:first-child .content")},getWorkingColumn:function(a){return a.find(".column:first-child")}};var g={init:function(b){var h=a(this),i=h.data("runningBarChart");if(!i||typeof i=="undefined"||!i.isInitialized){var j=h.data("runningbarchart")||{};if(j&&typeof j=="object"){i=a.extend(true,{},c,j,b)}else{i=a.extend(true,{},c,b)}i.rows.minValue=i.rows.stepWidth;i.target=h;h.append('<div class="row-area"><div class="content" ></div></div>');h.append('<div class="column-area"><div class="content" ></div><div class="groups" ></div></div>');i.ca=h.find(".column-area > .content");i.ra=h.find(".row-area > .content");i.direction=i.direction=="rtl"?"rtl":"ltr";i.fns=i.direction=="rtl"?e:f;h.data("runningBarChart",i);i.target.addClass(i.direction);for(var k=i.rows.minValue;k<=i.rows.maxValue;k+=i.rows.stepWidth){d.call(this,k)}var l=typeof i.columns.values=="array"?i.columns.values.reverse():[],m=l.length>=1?l.length:i.columns.number,n=i.columns.multivalue?[0]:0;i.columns.number=m;i.columns.cssWidth=Math.floor(1/m*1e3)/10+"%";while(m){g["addColumn"].call(this,typeof l[m]=="undefined"?0:typeof l[m]);m--}var o=parseFloat(i.fns.getWorkingColumn(i.ca).width());i.columns.cssWidth=o+"px";i.ca.find(".column").css("width",i.columns.cssWidth);i.ca.css("width",parseFloat(i.ca.width())+o+"px");i.forceRTLColumnShift=i.direction=="rtl"}},destroy:function(){var b=a(this),c=b.data("runningBarChart");a(window).unbind(".runningBarChart");b.removeData("runningBarChart")},addColumn:function(b){var c=a(this).data("runningBarChart"),d=c.ca;b=Math.max(0,parseFloat(b));c.fns.insertColumn(d,'<div class="column" style="width: '+c.columns.cssWidth+';"><div class="content low" data-value-y="'+b+'" style="height:0%"><div class="label low">'+b+"</div></div></div>");var e=c.fns.getWorkingColumn(d).width(),f=d.find(".column").length*e;if(c.forceRTLColumnShift||f>d.width()){c.fns.shiftColumns(a(this),d,e)}this.skipAnim=true;g["setColumValue"].call(this,b)},setColumnValue:function(b){var c=a(this).data("runningBarChart"),d=c.ca,e=c.fns.getWorkingColumnContent(d),f=e.find(".label"),g=c.rows.maxValue,h=c.rows.stepWidth,i=parseFloat(e.attr("data-value-y")),j=0;b=Math.max(0,parseFloat(b));e.attr("data-value-y",b);f.html(b);if(b<=g){if(this.skipAnim==true){e.css("height",b/g*100+"%").fadeIn()}else{e.stop(false,true).animate({height:b/g*100+"%"})}}else{var k=Math.ceil((b-g)/h);while(k){g=c.rows.maxValue=c.rows.maxValue+h;addRow.call(this,c.rows.maxValue);k--}d.find(".column > .content").each(function(){var b=a(this),c=parseFloat(b.attr("data-value-y"))/g*100;b.css("height",c+"%")})}f.removeClass("high");f.removeClass("low");e.removeClass("high");f.removeClass("low");if(b<=h){f.addClass("low");e.addClass("low")}else if(b>=g-h*.5){f.addClass("high");e.addClass("high")}this.skipAnim=false},getColumnValue:function(){var b=a(this).data("runningBarChart"),c=b.fns.getWorkingColumnContent(b.ca);return parseFloat(c.attr("data-value-y"))},addRow:function(b){var c=a(this).data("runningBarChart"),e=c.rows.maxValue,f=c.rows.stepWidth,g=false;if(!isNaN(b)&&b>e){c.rows.maxValue=b;d.call(this,b);g=true}else if(isNaN(b)){c.rows.maxValue=e+f;d.call(this,c.rows.maxValue);g=true}if(g){c.ca.find(".column > .content").each(function(){var b=a(this),d=parseFloat(b.attr("data-value-y"))/c.rows.maxValue*100;b.css("height",d+"%")})}}};g["setColumValue"]=g["setColumnValue"];a.fn.runningBarChart=function(c){if(g[c]){var d=Array.prototype.slice.call(arguments,1);if(c.indexOf("get")===0){var e=[];this.each(function(){e.push(g[c].apply(this,d))});return e.length==1?e[0]:e}else{return this.each(function(){return g[c].apply(this,d)})}}else if(typeof c==="object"||!c){var d=arguments;return this.each(function(){return g.init.apply(this,d)})}else{a.error("Method "+c+" does not exist on jQuery.runningBarChart V."+b)}}})(jQuery)